<html layout:decorate="~{common/layout.html}">

<head>
    <title>Holistic Releasing</title>

    <style>

        .answer {
            background-color: #18181b !important;
            border: none !important;
            color: white !important;
        }

        .answer:hover {
            background-color: black !important;
        }

        input:focus {
            outline: none !important;
        }

        .start:hover {
            background-color: #7f8080 !important;
        }
    </style>
</head>

<body>

<main layout:fragment="main" class="min-h-screen flex flex-col">

    <div class="flex-grow flex items-center justify-center" id="app">
        <div class="max-w-2xl w-full px-4">
          <div class="flex flex-col gap-6">

            <div class="input-group flex justify-center">
                <input type="text" id="subject" placeholder="주제를 입력하세요" class="input input-bordered w-3/5 text-black" style="background-color: #cccccc;"/>
                <button onclick="start()" class="btn w-1/6 start" style="background-color: #b2b3b3; border: none;">시작</button>
            </div>

            <p id="question" class="text-center text-2xl mt-10 mb-10"></p>

            <div class="flex justify-center gap-6">
                <button class="btn w-1/3 answer" onclick="next()">
                    <span>네</span>
                </button>
                <button class="btn w-1/3 answer" onclick="next()">
                    <span>아니오</span>
                </button>
            </div>

              <div class="flex justify-center text-lg">
                  <p>카운트 : &nbsp</p>
                  <p id="count">0</p>
              </div>


          </div>
        </div>
    </div>

    <script>
        function start() {
            const subject = document.getElementById('subject').value;
            fetch(`/api/start?subject=${subject}`, {
                method: 'GET'
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('question').textContent = data.question;
                document.getElementById('count').textContent = data.count; // 초기 count 값도 설정
            })
            .catch(error => console.error('Error:', error));
        }

        function next() {
            fetch('/api/next', {
                method: 'GET'
            })
            .then(response => response.json())
            .then(data => {
                // 질문과 count를 업데이트
                document.getElementById('question').textContent = data.question;
                document.getElementById('count').textContent = data.count; // resist 모드에서만 증가된 count 값을 받아옴
            })
            .catch(error => console.error('Error:', error));
        }

        // 페이지가 로드될 때 실행되는 함수
        window.onload = function() {
            fetch('/api/reload')
            .then(response => response.json())
            .then(data => {
                if (data.subject) {
                    document.getElementById('subject').value = data.subject;
                }
                if (data.question) {
                    document.getElementById('question').textContent = data.question;
                }
                if (data.count) {
                    document.getElementById('count').textContent = data.count;
                }
                // 필요한 다른 로직 추가
            })
            .catch(error => console.error('Error:', error));
        };
    </script>
</main>

</body>

</html>
